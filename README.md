# Hello-Combine-with-Udemy
Combine framework study with Udemy lecture

- reference lecture url : https://www.udemy.com/course/the-complete-guide-to-combine-framework-in-ios-using-swift/

<br>

## Hello, Combine with Udemy ìŠ¤í„°ë”” ëª©ì°¨

### [ìŠ¤í„°ë”” ê³„íš](https://github.com/iOS-Udemy-Study-Group/Hello-Combine-with-Udemy#ìŠ¤í„°ë””-ê³„íš-1)

### [Section 1: Introduction](https://github.com/iOS-Udemy-Study-Group/Hello-Combine-with-Udemy#section-1-introduction-1)

### [Section 2: Publishers, Subscribers and Operators](https://github.com/iOS-Udemy-Study-Group/Hello-Combine-with-Udemy#section-2-publishers-subscribers-and-operators-1)
### [Section 3: Transforming Operators](https://github.com/iOS-Udemy-Study-Group/Hello-Combine-with-Udemy#section-3-transforming-operators-1)

### [Section 4: Filtering Operators](https://github.com/iOS-Udemy-Study-Group/Hello-Combine-with-Udemy#section-4-filtering-operators-1)

### [Section 5: Combining Operators](https://github.com/iOS-Udemy-Study-Group/Hello-Combine-with-Udemy#section-5-combining-operators-1)

<br>

## ìŠ¤í„°ë”” ê³„íš

Udemy ê°•ì˜ë¥¼ í™œìš©í•˜ì—¬ Combine framework ìŠ¤í„°ë”” ì˜ˆì •
- ë§¤ì£¼ ë‹¤ìˆ˜ê²°ë¡œ ìŠ¤í„°ë”” ë‚ ì§œ ì§€ì • í›„, 2ì‹œê°„ ìŠ¤í„°ë”” ì§„í–‰

### 1ì£¼ì°¨ ìŠ¤í„°ë”” 
- 11/26(í† ), ì˜¤í›„ 10ì‹œ ~ 12ì‹œ (ì™„ë£Œ)
- 1-1. introduction ~ 3-22. replaceEmpty ê¹Œì§€ ìŠ¤í„°ë”” ì§„í–‰
- ğŸ‘©ğŸ»â€ğŸ’» [applebuddy](https://github.com/applebuddy) | [AppleCEO](https://github.com/appleceo) | [betterhee](https://github.com/betterhee) | [Lim-YongKwan](https://github.com/lim-yongkwan)

### 2ì£¼ì°¨ ìŠ¤í„°ë””
- 12/3(í† ), ì˜¤í›„ 10ì‹œ  ~ 12ì‹œ (ì™„ë£Œ)
- 3-23. scan operator ~ 5-41. combineLatest ê¹Œì§€ ìŠ¤í„°ë”” ì§„í–‰
- ğŸ‘©ğŸ»â€ğŸ’» [applebuddy](https://github.com/applebuddy) | [AppleCEO](https://github.com/appleceo) | [Lim-YongKwan](https://github.com/lim-yongkwan) | [yeoneei](https://github.com/yeoneei)

### 3ì£¼ì°¨ ìŠ¤í„°ë””
- 12/11(ì¼), ì˜¤í›„ 8ì‹œ ~ 10ì‹œ (ì™„ë£Œ)
- 5-42. zip ~ 9-57. Timer class
- ğŸ‘©ğŸ»â€ğŸ’» [applebuddy](https://github.com/applebuddy) | [AppleCEO](https://github.com/appleceo) | [betterhee](https://github.com/betterhee) | [Jae-eun](https://github.com/jae-eun) | [Lim-YongKwan](https://github.com/lim-yongkwan)

<br>

## ìŠ¤í„°ë”” ë°©ì‹

- Udemy ê°•ì˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ìŠ¤í„°ë”” ë‚´ìš©ì„ ìŠ¤í„°ë””ì› ë³„ë¡œ ê³µìœ  ë° í† ë¡ í•˜ë©° ê³µìš© ë¬¸ì„œë¥¼ ì •ë¦¬

- ê°ì í•™ìŠµí•œ ë‚´ìš©ì€ ê³µìš© study repositoryì— ê³µìœ 
  - ê°ì ì ë‹¹í•œ ì˜ë¬´ê°ì„ ê°–ê³  ìŠ¤í„°ë””í•˜ê¸° ìœ„í•¨
- ê°œì¸ì ìœ¼ë¡œ ê³µë¶€í•œ ë‚´ìš©ì€ ê°œì¸í´ë”ì— ê¸°ë¡ (fork í›„, ê°œì¸ ìŠ¤í„°ë”” ë‚´ìš© ê¸°ë¡ í–ˆë‹¤ê°€ ê³µìš© repositoryì— PR)
- ìŠ¤í„°ë”” ì£¼ì°¨ë§ˆë‹¤ ë©¤ë²„ê°€ í•œ ëª…ì”© ìŠ¤í„°ë”” ê¸°ë¡ ë‹´ë‹¹ì„ ëŒì•„ê°€ë©° ë§¡ìœ¼ë©° readme.md íŒŒì¼ì˜ ë‚´ìš©ì„ ë³´ì™„ ë° ì„œë¡œ ë¦¬ë·°
  - í˜„ì¬ readme.md ë‚´ìš©ì€ ê¸°ì¡´ ê°•ì˜ ê³µë¶€í•œ ìŠ¤í„°ë””ì¥ì´ ê°œì¸ì ìœ¼ë¡œ ê¸°ë¡í•œ ë‚´ìš©ì„ ì˜®ê²¨ ë†“ì€ ê²ƒ
  - ìŠ¤í„°ë”” ê¸°ë¡ ì •ë¦¬ ë°©ì‹ì— ëŒ€í•œ ì¢‹ì€ ì˜ê²¬ ììœ ë¡­ê²Œ ê³µìœ 
- Udemy ê°•ì˜ ìŠ¤í„°ë”” ì¤‘ì— ì§ˆë¬¸ì‚¬í•­ì´ ìˆìœ¼ë©´ ì±„íŒ…ì„ í†µí•´ ì•Œë ¤ì£¼ê³ , ë°”ë¡œì¡ê³  ê°€ê¸°

<br>

### ìŠ¤í„°ë””ì—ì„œ ë‚˜ì˜¨ ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸

- Combineê³¼ KVOì˜ ì—°ê´€ì„±ì€?
- eraseToAnyPublisherì˜ ì—­í• ?
  - Publisher ì—°ì‚° ê²°ê³¼ë¥¼ ì¶”ìƒí™”, ë‚´ë¶€ ì—°ì‚°ê³¼ì •ì€ ìˆ¨ê¸°ê³ , ê²°ê³¼ íƒ€ì…ë§Œ ì™¸ë¶€ì— ë…¸ì¶œì‹œí‚¬ë•Œ ì‚¬ìš©, ì´í›„ ì¤‘ê°„ ì—°ì‚° ê³¼ì •ì˜ ë³€í™”ì— ëŒ€í•œ ì™¸ë¶€ ì˜í–¥ë„ê°€ ì¤„ì–´ë“¦


<br>
<br>



## Section 1: Introduction

### 1-5. What is functional Programming

- Imparative(ëª…ë ¹í˜•) í”„ë¡œê·¸ë˜ë°ê³¼ ë‹¬ë¦¬, functional(í•¨ìˆ˜í˜•) í”„ë¡œê·¸ë˜ë°ì€ ìƒíƒœê°€ ë°”ë€ŒëŠ” ê°’ì´ immutableí•˜ê²Œ êµ¬ì„±ë  ìˆ˜ ìˆë‹¤.
- ê¸°ì¡´ì— ì‚¬ìš©ë˜ë˜ ëª…ë ¹í˜• í”„ë¡œê·¸ë˜ë°ê³¼ ë‹¬ë¦¬, í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì€ immutable í•˜ë‹¤ëŠ” ì°¨ì´ì ì´ ìˆë‹¤. ëª…ë ¹í˜• í”„ë¡œê·¸ë˜ë°ì€ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³ , íŠ¹ì • ìœ„ì¹˜ì—ì„œ ë³€ìˆ˜ê°€ ë³€ê²½ëœë‹¤. ì´ëŸ° mutable stateëŠ” Concurrency, Dead Locks, Race Conditions ë“±ì—ì„œ ë¬¸ì œë¥¼ ì•¼ê¸°í•  ê°€ëŠ¥ì„±ì´ í¬ë‹¤.
- í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì€ ëª…ë ¹í˜• í”„ë¡œê·¸ë˜ë°ê³¼ ë‹¬ë¦¬ immutableí•˜ê²Œ ê°’ì´ ì •ì˜ë  ìˆ˜ ìˆë‹¤.  í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” filter, map, reduce ë“± ë‹¤ì–‘í•œ 1ê¸‰ê°ì²´ì˜ í•¨ìˆ˜ë“¤ì„ í•„ìš”ì— ë”°ë¼ í•¨ê»˜ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
  - Pure Functions
    - functionì€ í•­ìƒ ê°™ì€ inputì— ëŒ€í•´ ë™ì¼í•œ outputì„ ìƒì‚°í•œë‹¤.
    - functionì€ side effectsë¥¼ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.

### 1-6. What is Combine Framework?

- reference : https://www.avanderlee.com/swift/combine/
- Appleì˜ built-in framework, ì´ë²¤íŠ¸ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•œ operatorë“¤ì„  ê²°í•©í•˜ì—¬ ë¹„ë™ê¸° ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

### 1-7. RxSwift vs Combine

- reference : https://medium.com/@M0rtyMerr/will-combine-kill-rxswift-64780a150d89

- RxSwiftëŠ” iOS 8 ì´ìƒì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ ë°˜ë©´, Combineì€ ì• í”Œì—ì„œ ë§Œë“  ë‚´ì¥ frameworkì´ë‹¤.



## Section 2: Publishers, Subscribers and Operators

### 2-8. Hello Publishers and Subscribers

### Publishers

- PublisherëŠ” ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•  ìˆ˜ ìˆë‹¤. (RxSwiftì˜ Observableê³¼ ìœ ì‚¬)
- Output, Failure ì—°ê´€ íƒ€ì…ì„ ê°–ëŠ”ë‹¤.
- Publisher í”„ë¡œí† ì½œì„ ì±„íƒí•˜ì—¬ ì •ì˜í•  ìˆ˜ ìˆë‹¤. 
- Subscriberë¡œë¶€í„° êµ¬ë…ì„ ë‹¹í•  ìˆ˜ ìˆë‹¤. êµ¬ë…ì„ ë‹¹í• ë•Œ Subscriptionì„ ë§Œë“¤ì–´ì„œ Subscriberì—ê²Œ ì „ë‹¬í•œë‹¤. ì´í›„ êµ¬ë…ì´ í•´ì§€ë˜ê¸° ì „ê¹Œì§€ êµ¬ë…ìì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•œë‹¤.

### Subscribers

- Publisher, Subjectë¥¼ êµ¬ë…í•  ìˆ˜ ìˆë‹¤. (RxSwiftì˜ Observerì™€ ìœ ì‚¬)
- Input, Failure ì—°ê´€ íƒ€ì…ì„ ê°–ëŠ”ë‹¤.
- êµ¬ë…ì„ í–ˆì„ë•Œ Subscriptionì„ ë°›ëŠ” ë©”ì„œë“œ, êµ¬ë… ê°„ ì´ë²¤íŠ¸ë¥¼ ë°›ëŠ” ë©”ì„œë“œ, êµ¬ë…ì´ ëë‚¬ì„ë•Œ completed ë©”ì„œë“œê°€ ì •ì˜ëœë‹¤.
- Appleì—ì„œëŠ” Custom Subscriberì˜ ì‚¬ìš©ì„ ê¶Œì¥í•˜ì§€ ì•ŠëŠ” ê²ƒìœ¼ë¡œ ì•Œê³  ìˆë‹¤.
  - assign, sink ë“±ì„ ì‚¬ìš©í•´ì„œ Custom Subscriber êµ¬í˜„ ì—†ì´ Appleì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” Subscriberë¥¼ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.
- Subscriberê°€ Publisherë¥¼ êµ¬ë…í•˜ë©´, PublisherëŠ” ë°ì´í„° ì´ë²¤íŠ¸ë¥¼ Subscriberì—ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.
  - Publisher -----> Stream of Data  ----->  Subscriber
  - êµ¬ë… ì‹œ PublisherëŠ” Subscriberì—ê²Œ subscriptionì„ ì „ë‹¬í•œë‹¤. ì´ë•Œ SubscriberëŠ” ì–¼ë§ˆë‚˜ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ì§€ ìš”ì²­í•  ìˆ˜ ìˆë‹¤.
  - PublisherëŠ” ìš”ì²­ë°›ì€ ë§Œí¼ì˜ ì´ë²¤íŠ¸ë¥¼ Subscriberì—ê²Œ ì „ë‹¬í•œë‹¤. SubscriberëŠ” ì´ë²¤íŠ¸ ê°’ì„ ë°›ìœ¼ë©´ ì´ì— ë§ëŠ” requestë¥¼ í•˜ê±°ë‚˜ ê·¸ëƒ¥ ë°›ê¸°ë§Œ í•  ìˆ˜ ìˆë‹¤.
  - êµ¬ë…ì´ ì¢…ë£Œë˜ë©´, SubscriberëŠ” completion ì´ë²¤íŠ¸ë¥¼ ë°›ëŠ”ë‹¤.



### 2-9. Sending Notifications Using Publisher and Subscriber

- Combineì˜ PublisherëŠ” êµ¬ë…(sink)ì´ ê°€ëŠ¥í•˜ë‹¤. í´ë¡œì ¸ë¥¼ í†µí•´ êµ¬ë…í•œ Publisherì˜ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹  ë°›ì„ ìˆ˜ ìˆë‹¤.
  - Combineì˜ PublisherëŠ” RxSwiftì˜ Observableì™€ ìœ ì‚¬, (ë‘˜ ë‹¤ Subject, Subscriber(RxSwift Observer)ë¥¼ ê°€ì§)
- sinkëŠ” AnyCancellable íƒ€ì…ì„ ë°˜í™˜í•œë‹¤. RxSwiftì˜ subscribeê°€ Disposableì„ ë°˜í™˜í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ë‹¤.
- RxSwift, Combineì˜ êµ¬ë… ì˜ˆì‹œ

~~~swift
let disposable = NotificationCenter.default.rx.notification(notification)
      .observe(on: MainScheduler.instance)
      .subscribe(onNext: { _ in
        print("RxSwift Notification received")
      }).disposed(by: disposeBag)

let publisher = NotificationCenter.default.publisher(for: notification, object: nil)
let subscription = publisher.sink { _ in
  print("Combine Notification received")
}

// êµ¬ë…ì´ ì‹œì‘ë˜ë©´, êµ¬ë… í•´ì§€ ì´ì „ê¹Œì§€ Publisherì˜ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.
NotificationCenter.default.post(name: notification, object: nil)
~~~



### 2-10. Understanding Cancellable

- New Paperë¥¼ ì˜ˆë¡œ ë“¤ì–´ë³´ì. êµ¬ë…ì„ í•˜ë‹¤ê°€ ì·¨ì†Œë¥¼ í•´ì•¼ ì‹ ë¬¸ì„ ê·¸ë§Œ ë³¼ ìˆ˜ ìˆë‹¤.
- êµ¬ë… ì·¨ì†Œ í›„ì˜ Observable, Publisher ì´ë²¤íŠ¸ëŠ” ë°›ì„ ìˆ˜ ì—†ë‹¤.
- êµ¬ë… í•´ì§€ë¥¼ í• ë•Œ êµ¬ë…ì„ í†µí•´ ë°˜í™˜ë°›ì€ AnyCancellableì„ ê°–ê³  ìˆë‹¤ê°€ ì¤‘ê°„ì— nilì„ í• ë‹¹í•˜ê±°ë‚˜, ì‚¬ìš© ì˜ì—­ ìƒì• ì£¼ê¸°ê°€ ëë‚˜ë©´ ìë™ìœ¼ë¡œ í•´ì œëœë‹¤. (Cancellableì€ cancel()ë¡œ í•´ì œí•´ì£¼ì–´ì•¼ í•¨), í˜¹ì€ storeì— Set<AnyCancellable> ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë„£ì–´ì„œ êµ¬ë…ì •ë³´ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.





### 2-11. Subscriber

- Publisherì˜ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” êµ¬ë…ì´ í•„ìš”í–ˆë‹¤. ê·¸ êµ¬ë…ì„ í•˜ëŠ” ê²ƒì´ Subscriberì´ë‹¤. SubscriberëŠ” Input, Failure ì—°ê´€ íƒ€ì…ì„ ê°–ê³  ìˆëŠ”ë°, Publisherì˜ Outputê³¼ Subscriberì˜ Input, ì–‘ìª½ì˜ Failureê°€ ì¼ì¹˜í•´ì•¼ êµ¬ë…ì„ í•  ìˆ˜ ìˆë‹¤
- Publisherì™€ Subscriberì˜ êµ¬ë… í›„ ìƒí˜¸ê´€ê³„ feat. Subscriber í”„ë¡œí† ì½œì„ ì±„íƒí•œ StringSubscriber ìƒì„±

~~~swift
class StringSubscriber: Subscriber {
  // Publisher            Subscriber ì˜ ìƒí˜¸ ê´€ê³„
  // <-------- subscribes
  //         gives subscription -->
  // <-------- requests values
  //         sends values -------->
  //         sends completion ---->
  
  // subscribe ì´í›„, publisherë¡œë¶€í„° subscriptionì„ ìˆ˜ì‹ í–ˆì„ë•Œ í˜¸ì¶œ ë©ë‹ˆë‹¤.
  func receive(subscription: Subscription) {
    print("Received Subscription")
    subscription.request(.max(3)) // publiserì•¼ ìµœëŒ€ 3ê°œì˜ ê°’ë§Œ ì¤˜ë´
  }
  
  // publisherë¡œë¶€í„° input ê°’ì„ ìˆ˜ì‹ í–ˆì„ë•Œ í˜¸ì¶œë©ë‹ˆë‹¤.
  func receive(_ input: String) -> Subscribers.Demand {
    print("Received value : \(input)")
    return .none // publisherí•œí…Œ ë”ì´ìƒ ë°›ì„ ê²ƒ ì—†ì–´
//    return .unlimited // ì¤„ ìˆ˜ ìˆëŠ”ê±° ë‹¤ ë°›ì„ë˜
  }
  
  // publisherê°€ publish ì´ë²¤íŠ¸ë¥¼ ë§ˆì³¤ì„ë•Œ í˜¸ì¶œ ë©ë‹ˆë‹¤.
  func receive(completion: Subscribers.Completion<Never>) {
    print("Completed")
  }

  typealias Input = String
  typealias Failure = Never // Failureë¥¼ Neverë¡œ ì§€ì •í•˜ë©´ failì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
}

~~~

- Custom Subscriberë¡œ Publisher êµ¬ë… í›„ ì‚¬ìš©í•˜ê¸°

~~~swift
let publisher = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"].publisher
let subscriber = StringSubscriber()
publisher.subscribe(subscriber)
// ì¶œë ¥ ê²°ê³¼ 
// -> .max(3)ìœ¼ë¡œ requestë¥¼ í–ˆìœ¼ë¯€ë¡œ "A", "B", "C" ì„¸ê°œì˜ ì´ë²¤íŠ¸ë¥¼ ë°›ìŠµë‹ˆë‹¤.
// * unlimitedë¡œ inputì„ ë°›ëŠ” ê²½ìš°, ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ë°›ìŠµë‹ˆë‹¤.
// * ìš”ì²­í•˜ê³  ì‹¶ì§€ ì•Šìœ¼ë©´ .noneì„ ë°˜í™˜í•˜ë©´ ë©ë‹ˆë‹¤.
/*
Received Subscription
Received value : A
Received value : B
Received value : C
 */
~~~



### 2-12. Subjects

- Publisher ì´ë©´ì„œ Subscriberì´ë‹¤. (RxSwiftì˜ Observableì´ë©´ì„œ Subscriberì¸ Subjectì™€ ìœ ì‚¬)
- ì´ˆê¸°ê°’ì´ ì—†ëŠ” PassthroughSubject, ì´ˆê¸°ê°’ì„ ê°–ëŠ” CurrentValueSubjectê°€ ìˆë‹¤. (RxSwiftì˜ PublishSubject, BehaviorSubjectì™€ ìœ ì‚¬)
- RxCocoaì—ì„œ ì œê³µí•˜ëŠ” PublishRelay, BehaviorRelayì™€ ê°™ì€ SubjectëŠ” ì œê³µí•˜ì§€ ì•Šì•„ ì‚¬ìš©ì„ ìœ„í•´ì„œëŠ” Custom êµ¬í˜„ì„ í•´ì•¼ í•œë‹¤. (Failure ì—°ê´€ íƒ€ì…ì„ Neverë¡œ ì§€ì •)
- ì›í•˜ëŠ” ì‹œì ì— sendë¥¼ í†µí•´ êµ¬ë…ìë“¤ì„ ìœ„í•œ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•  ìˆ˜ ìˆë‹¤.

~~~swift
let subscriber = StringSubscriber()
let subject = PassThroughSubject<String, MyError>()
// SubjectëŠ” Publisherì²˜ëŸ¼ êµ¬ë…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì¦‰, Subscriberê°€ êµ¬ë…í•˜ì—¬ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, Subjectì—ì„œ ì›í•  ë•Œ ì´ë²¤íŠ¸ë¥¼ Subscriberë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

// 1) SubscriberëŠ” Subjectë¥¼ êµ¬ë…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
subject.subscribe(subscriber)

// 2) SubjectëŠ” Publisherë¡œì„œ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
let subscription = subject.sink { completion in 
	print("Received Completion from sink")
} receiveValue: { value in
  print("Received Value from sink, value: \(value)")
}

subject.send("A") // Received value : A
subject.send("B") // Received value : B
subject.send("C") // .max(2)ë¡œ requestë¥¼ í–ˆì„ ê²½ìš°, ì„¸ë²ˆì§¸ ì´ë²¤íŠ¸ì¸ CëŠ” ë°©ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. inputì„ ë°›ì„ë•Œ .none ëŒ€ì‹  .max(1)ì„ ë°˜í™˜í•˜ë©´ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.
subject.send("B")

subscription.cancel()

subject.send("ã…œã…œ") // êµ¬ë…ì´ ì·¨ì†Œë˜ë©´ ì´í›„ ì´ë²¤íŠ¸ëŠ” ë°©ì¶œë˜ì§€ ì•Šì•„ìš”.
subject.send("ã… ã… ")
~~~



### 2-13. Type Eraser (eraseToPublisher)

- ì‚¬ìš©í•œ Publisher ì—°ì‚° ê²°ê³¼ì˜ íƒ€ì…ì„ ê°€ë¦¬ê³  ì‹¶ì„ë•Œ Type Eraserë¡œì„œ eraseToPublisherë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- eraseToAnyPublisherë¥¼ ì‚¬ìš©í•˜ë©´ AnyPublisheríƒ€ì…ìœ¼ë¡œ ë°”ë€ë‹¤. (ê¸°ì¡´ Publisher ê²°ê³¼íƒ€ì…ì„ ë˜í•‘í•œë‹¤.)
- ë‹¤ì–‘í•œ operatorë¥¼ ê°€ì ¸ê°€ëŠ” ê²½ìš° íƒ€ì…ì´ ë§¤ìš° ë³µì¡í•´ì§€ê³ , íŒŒì´í”„ë¼ì¸ì´ ëª¨ë‘ ì™¸ë¶€ì— ë…¸ì¶œë˜ëŠ” ë¬¸ì œê°€ ìˆë‹¤.
  - ì´ë•Œ eraseToAnyPublisherë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ì¡´ì˜ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ê³¼ ìƒê´€ì—†ì´ ìµœì¢…ì ì¸ í˜•íƒœì˜ Publisherë¥¼ ë°˜í™˜í•œë‹¤. ìµœì¢…ì ìœ¼ë¡œ ë°›ê²Œ ë˜ëŠ” ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ëª©ì ìœ¼ë¡œë§Œ íƒ€ì…ì„ ë³€í™˜í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

~~~swift
let publisher = PassthroughSubject<Int, Never>() // PassthroughSubject<Int, Never>
  .map { $0 } // Publisher.Map<PassthroughSubject<Int, Never>, Int>
  .eraseToAnyPublisher()
// => AnyPublisher<Int, Publishers.Map<PassthroughSubject<Int, Never>, Int>.Failure>
~~~



## Section 3: Transforming Operators

### 3-14. Understandinig Transforming operators

- ê¸°ì¡´ Sequenceë¥¼ ê°ê°ì˜ elementì— ëŒ€í•´ íŠ¹ì • ì—°ì‚°ì„ ì ìš©í•œ ìƒˆë¡œìš´ Sequenceë¡œ ë³€í™˜ì‹œí‚¨ë‹¤.

~~~swift
// ex) [1, 2, 3] -> ["1", "2", "3"]
// í•„ìš”ì— ë”°ë¼ ì‚¬ìš©ê°€ëŠ¥í•œ ë‹¤ì–‘í•œ Transformation Operatorê°€ ì¡´ì¬í•œë‹¤.
~~~



### 3-15. collect operator

- collect operatorëŠ” ë°©ì¶œí•  ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ í•˜ë‚˜ë¡œ ëª¨ì•„ë†“ì€ Arrayë¡œ ë°˜í™˜í•œë‹¤.
- collect N : Int ì¸ìë¥¼ ë„£ìœ¼ë©´ Nê°œ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ì„œ Arrayë¥¼ ë°˜í™˜í•œë‹¤.

~~~swift
let anyCancellable = ["A", "B", "C", "D"].publisher.collect(3)
	.sink { element in 
	print(element)
}

anyCancellable.cancel()
~~~



### 3-16. map operator

~~~swift
// MARK: 16. map operator
// ex) [100, 23] -> ["one hundred and twenty three"]ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•?

let formatter = NumberFormatter()
formatter.numberStyle = .spellOut

[213, 45, 67].publisher.map {
  // map operatorë¥¼ í†µí•´ Sequenceì— ìˆëŠ” ê°ê°ì˜ elementsë¥¼ íŠ¹ì • ì—°ì‚°í•˜ì—¬ ë˜ë‹¤ë¥¸ Sequenceë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤.
  formatter.string(from: NSNumber(integerLiteral: $0))
}.sink { element in
  print(element)
}
~~~



### 3-17. map with keyPath

~~~swift
// MARK: 17. map KeyPath
// map operatorì—ì„œ KeyPathë¥¼ ì‚¬ìš©í•˜ì—¬ structureì˜ ê°œë³„ ê°’ë“¤ì„ ì ‘ê·¼í•˜ì—¬ ë‹¤ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤.

struct Point {
  let x: Int
  let y: Int
}

let publisher = PassthroughSubject<Point, Never>()
publisher.map(\.x, \.y).sink(receiveValue: { x, y in
  print("x is \(x) and y is \(y)")
})

publisher.send(Point(x: 1, y: 2))
publisher.send(Point(x: 10, y: 20))
~~~



### 3-19. replaceNil operator

- publisher sequenceì— nilì´ ìˆì„ ê²½ìš° nilì„ íŠ¹ì • ê°’ìœ¼ë¡œ ë³€í™˜í•œ sequenceë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

~~~swift
// MARK: 19. replaceNil operator
// replaceNil : publiser sequenceì— nilì´ ìˆì„ ê²½ìš° nilì„ íŠ¹ì • ê°’ìœ¼ë¡œ ë³€í™˜í•œ sequenceë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
// MARK: 20. Challenge - Unwrapping the Optional Values Received from replaceNil
// Q. replaceNilì´ ë°˜í™˜í•˜ëŠ” [String?] íƒ€ì… ëŒ€ì‹  [String] íƒ€ì…ì´ ë‚´ë ¤ì˜¤ê²Œ í•˜ëŠ” ë°©ë²•ì€?
// 1) map { $0! } ì„ ì‚¬ìš©í•˜ì—¬ ì–¸ë˜í•‘ì„ í•  ìˆ˜ ìˆë‹¤. ê°•ì œ ì˜µì…”ë„ ì–¸ë˜í•‘ì€ ì•ˆì „í•˜ì§€ ì•Šì€ ë°©ë²•ì´ë‹¤. í•˜ì§€ë§Œ replaceNiilì„ í†µí•´ nilì¸ ê°’ì„ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë°”ê¾¸ì—ˆê¸° ë•Œë¬¸ì— ì •ìƒì ìœ¼ë¡œ ì–¸ë˜í•‘ ë¨. (ê·¸ëƒ¥ ì•„ë‹ˆë©´ compactMap ì“°ë©´ ë¨)
["A", "B", nil, "C"].publisher.replaceNil(with: "x")
	.map { $0! }
  .sink {
    print($0)
  }
~~~



### 3-22. replaceEmpty operator

~~~swift
// MARK: 22. replaceEmpty operator
// Empty<Int, Never> PublisherëŠ” ì–´ë– í•œ ê°’ì„ ë°©ì¶œí•˜ì§€ ì•Šìœ¼ë©°, ì—ëŸ¬ë˜í•œ ë°©ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
let empty = Empty<Int, Never>()
//let cancellable = [1, 2, 3, 4, 5].publisher.sink { print($0) }
//cancellable.cancel()

empty
  .replaceEmpty(with: 1) // replaceEmpty operatorë¥¼ í†µí•´ Empty Publisherì˜ ê°’ì„ íŠ¹ì • ê°’ìœ¼ë¡œ ë°”ê¾¸ì–´ êµ¬ë…ìì—ê²Œ ì „ë‹¬ ê°€ëŠ¥
  .sink(receiveCompletion: {
  print($0) // 1, finished
}, receiveValue: {
  print($0)
})
~~~



### 3-23. scan operator

- reduceì™€ ì‚¬ìš©ë°©ì‹ì´ ìœ ì‚¬í•©ë‹ˆë‹¤. ì°¨ì´ì ì´ë¼ë©´, reduceëŠ” Sequence ì—°ì‚°ì˜ ê²°ê³¼ í•˜ë‚˜ë§Œ down streamìœ¼ë¡œ ë‚´ë ¤ì£¼ì§€ë§Œ, scanì€ Sequence ê° Element ì—°ì‚° ê²°ê³¼ë¥¼ ëª¨ë‘ ë°˜í™˜í•©ë‹ˆë‹¤. 

~~~swift
// MARK: 23. scan operator
// RxSwiftì˜ scanì™€ ì´ë¦„ì´ ë™ì¼í•˜ê³  ê¸°ëŠ¥ë„ ìœ ì‚¬í•œ operatorë¡œ Sequenceì˜ ì—°ì‚° ê²°ê³¼ë¥¼ ëª¨ë‘ ë°˜í™˜í•œë‹¤.
let publisher = (1...10).publisher
publisher.scan([]) { numbers, value -> [Int] in
// numbers: [Int]ì— ì—°ì‚°ì´ ëˆ„ì ëœë‹¤., value: Int ëŠ” publisherì˜ ê°ê°ì˜ element
  return numbers + [value] // publisher ê°’ì„ ìˆœì°¨ì ìœ¼ë¡œ append í•˜ê³  ìˆë‹¤.
}.sink { scanValue in
  print(scanValue) // scan operatorì˜ appending ì—°ì‚° ê³¼ì •ì´ ëª¨ë‘ ì¶œë ¥ëœë‹¤.
}
/*
// Scan Operator Output
[1]
[1, 2]
[1, 2, 3]
...
[1, 2, 3, 4, 5, 6, 7, 8, 9]
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
*/
~~~



## Section 4: Filtering Operators

### 4-24. filter operator

- íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” Elementë“¤ì„ down streamì— ì „ë‹¬í•©ë‹ˆë‹¤.

~~~swift
// MARK: - Section 4. Filtering Operators
// MARK: 24. filter operator
// RxSwiftì˜ filterì™€ ë™ì¼í•˜ë‹¤. ê¸°ì¡´ Sequenceë¥¼ íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ê°’ë§Œ ìˆëŠ” Sequenceë¡œ ë°˜í™˜í•œë‹¤.
let numbers = (1...20).publisher
numbers.filter { $0 % 2 == 0 }.sink(receiveValue: {
  print($0) // (1...20) ê°’ë“¤ ì¤‘ ì§ìˆ˜ê°’ë§Œ ì¶œë ¥ëœë‹¤.
})
~~~



### 4-25. removeDuplicates operator

- Sequenceì—ì„œ ì—°ì†ì ìœ¼ë¡œ ì¤‘ë³µë˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³ , down streamì— ì „ë‹¬í•©ë‹ˆë‹¤.

~~~swift
// MARK: 25. removeDuplicates operator
// removeDuplicates operatorë¥¼ ì‚¬ìš©í•˜ë©´ Sequenceì˜ ì¤‘ë³µê°’ì„ ì œê±°í•œ Sequenceë¡œ ë°˜í™˜ë°›ì„ ìˆ˜ ìˆë‹¤.
// removeDuplicatesë¥¼ ì‚¬ìš©í• ë•Œ ëª¨ë“  ì¤‘ë³µê°’ì´ ì œê±°ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. Sequenceì—ì„œ ì—°ì†ëœ ì¤‘ë³µê°’ë§Œ í•œí•˜ì—¬ ë¬´ì‹œí•˜ì—¬ í•„í„°ë§í•œë‹¤.
// ì¤‘ë³µ ë¬¸ìì—´ì´ ìˆëŠ” ë°°ì—´ì— ëŒ€í•œ publisherë¥¼ ì„ ì–¸í•œë‹¤.
// 1) ì•„ë˜ String ë¬¸ìì—´ì€ components(separatedBy:) ì— ì˜í•´ [String] íƒ€ì…ìœ¼ë¡œ ë³€í™˜
// 2) String Sequence Publisherì— ëŒ€í•œ removeDuplicates ì—°ì‚°ìœ¼ë¡œ 2ë²ˆì§¸ appleì€ ì—°ì†ì ìœ¼ë¡œ ì¤‘ë³µë˜ë¯€ë¡œ ë¬´ì‹œë©ë‹ˆë‹¤.
let words = "apple apple fruit apple mango watermelon apple".components(separatedBy: " ").publisher
  .removeDuplicates()
words.sink {
  print($0)
}

/*
// Output
apple
fruit
apple
mango
watermelon
apple
*/
~~~



### 4-26. compactMap operator

- compactMap operatorëŠ” mapê³¼ ìœ ì‚¬í•œ ë™ì‘ì„ í•˜ì§€ë§Œ ì—°ì‚° ê²°ê³¼ê°€ non-optionalì¸ ê°’ë§Œ ëª¨ì•„ì„œ  Sequenceë¡œ ë³€í™˜í•˜ëŠ” ì°¨ì´ì ì´ ìˆë‹¤. ì¦‰, compactMap operatorëŠ”  non-optional Sequenceë§Œ ë°˜í™˜í•œë‹¤.

~~~swift
let strings = ["a", "1.24", "b", "3.45", "6.7"]
  .publisher.compactMap { Float($0) }
  .sink {
    // Float íƒ€ì…ìœ¼ë¡œ ë³€í™˜ ê°€ëŠ¥í•œ 1.24, 3.45, 6.7ë§Œ down streamìœ¼ë¡œ ë‚´ë ¤ì˜µë‹ˆë‹¤. mapì„ ì‚¬ìš©í–ˆë‹¤ë©´, ë³€í™˜ì´ ë¶ˆê°€ëŠ¥í•œ ì›ì†ŒëŠ” nilë¡œ ë‚´ë ¤ì˜µë‹ˆë‹¤.
    print($0) 
  }
~~~



### 4-27. ignoreOutput operator

- ignoreOutput operatorëŠ” Empty Publisherë¥¼ ë°˜í™˜í•˜ëŠ” operatorì…ë‹ˆë‹¤.
- completion eventë§Œ ë°›ê³  ê·¸ ì´ì™¸ì˜ ì´ë²¤íŠ¸ëŠ” ë¬´ì‹œí•˜ê³ ì í•  ë•Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

~~~swift
let numbers = (1...5000).publisher
numbers
  .ignoreOutput() // ignoreOutput operatorë¥¼ ì‚¬ìš©í•˜ë©´ completion ì´ë²¤íŠ¸ë§Œ ë°›ê³  ì´ì™¸ì˜ ì´ë²¤íŠ¸ëŠ” ë¬´ì‹œí•©ë‹ˆë‹¤.
  .sink {
  print($0) // finished Completionë§Œ ì „ë‹¬ ë°›ìŠµë‹ˆë‹¤.
} receiveValue: {
  print($0) // 1...5000ì˜ ê°’ì€ ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
}
~~~



### 4-28~29. first, last operator

- first operatorëŠ” Sequenceì˜ ì²«ë²ˆì§¸ í˜¹ì€ íŠ¹ì • ì¡°ê±´ì— ë§ëŠ” ì²«ë²ˆì§¸ ê°’ì„ ë°©ì¶œí• ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ë‹¨ìˆœ ì²«ë²ˆì§¸ ê°’ ë°©ì¶œì—ëŠ” first(), ì¡°ê±´ ì¶”ê°€ë¥¼ ìœ„í•´ì„œëŠ” first(where:) ì‚¬ìš©

- last operatorëŠ” Sequenceì˜ ë§ˆì§€ë§‰ í˜¹ì€ íŠ¹ì • ì¡°ê±´ì— ë§ëŠ” ë§ˆì§€ë§‰ ê°’ì„ ë°©ì¶œí• ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ë‹¨ìˆœ ë§ˆì§€ë§‰ ê°’ ë°©ì¶œì—ëŠ” last(), ì¡°ê±´ ì¶”ê°€ë¥¼ ìœ„í•´ì„œëŠ” last(where:) ì‚¬ìš©


~~~swift
// MARK: 28. first operator
// first operatorëŠ” Sequenceì˜ ì²«ë²ˆì§¸ í˜¹ì€ íŠ¹ì • ì¡°ê±´ì— ë§ëŠ” ì²«ë²ˆì§¸ ê°’ì„ ë°©ì¶œí• ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
// MARK: 29. last operator
// last operatorëŠ” Sequenceì˜ ë§ˆì§€ë§‰ í˜¹ì€ íŠ¹ì • ì¡°ê±´ì— ë§ëŠ” ë§ˆì§€ë§‰ ê°’ì„ ë°©ì¶œí• ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
let numbers = (1...9).publisher

numbers.first(where: { $0 % 2 == 0 }) // ì§ìˆ˜ì¸ ì²«ë²ˆì§¸ ê°’ì„ ë°©ì¶œ
  .sink {
    print($0) // 2 (sequence publisherì˜ ì²«ë²ˆì§¸ í™€ìˆ˜ ê°’
  }

numbers.last(where: { $0 % 2 == 1 }) // í™€ìˆ˜ì¸ ë§ˆì§€ë§‰ ê°’ì„ ë°©ì¶œ
  .sink {
    print($0) // 9 (sequence publisherì˜ ë§ˆì§€ë§‰ í™€ìˆ˜ ê°’)
  }
~~~



### 4-30~32. dropFirst / drop(while:) / drop(untilOutputFrom:) operator

- dropFirstëŠ” Sequenceì—ì„œ ìµœì´ˆ Nê°œì˜ ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³ ì í• ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- dropWhileì€ íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ë™ì•ˆ ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³ ì í• ë•Œ ì‚¬ìš©í•œë‹¤.
  - ìµœì´ˆ ì¡°ê±´ì„ ë¯¸ì¶©ì¡±í•˜ëŠ” ì‹œì ë¶€í„° ë‹¤ì‹œ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•œë‹¤.

- dropUntilOutputFromì€ triggerìš© Publisherë¡œë¶€í„° ì´ë²¤íŠ¸ë¥¼ ë°›ê¸° ì „ê¹Œì§€ ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•  ìˆ˜ ìˆë‹¤.
  - untilOutputFrom ë ˆì´ë¸” ì¸ìë¡œ ë„£ì€ Publisherê°€ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•˜ê¸° ì „ê¹Œì§€ ì´ë²¤íŠ¸ê°€ ë¬´ì‹œë©ë‹ˆë‹¤.


~~~swift
// MARK: 30. dropFirst operator
// dropFirstëŠ” Sequenceì—ì„œ ìµœì´ˆ Nê°œì˜ ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³ ìí• ë•Œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.
let numbers = (1...10).publisher
numbers.dropFirst(5)
	.sink {
    print($0)
  }

// MARK: 31. dropWhile operator
// dropWhileì€ Sequenceì—ì„œ íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ë™ì•ˆì€ ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³  ì¡°ê±´ì— ë¶€í•©ë˜ì§€ ì•ŠëŠ” ì´ë²¤íŠ¸ë¶€í„° ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•œë‹¤.
let numbers = (1...10).publisher
numbers.drop(while: { $0 != 3 }) // 1, 2ëŠ” 3ì´ ì•„ë‹ˆë¯€ë¡œ ë¬´ì‹œ, 3ë¶€í„° ì´ë²¤íŠ¸ê°€ ë°©ì¶œ
	.sink {
    print($0)
  }

// MARK: 32. dropUntilOutputFrom operator
// dropUntilOutputFrom operatorëŠ” íŠ¹ì • publisher(untilOutputFromì˜ ì¸ì)ë¡œë¶€í„° ì´ë²¤íŠ¸ë¥¼ ë°›ê¸° ì „ê¹Œì§€ ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•œë‹¤.
let taps = PassthroughSubject<Int, Never>() // ì´ë²¤íŠ¸ êµ¬ë… ê°ì§€í•  taps subject
let isReady = PassthroughSubject<Void, Never>() // triggerìš© isReady subject
taps.drop(untilOutputFrom: isReady)
	.sink(receiveValue: {
    print($0)
  })
// isReady publisherê°€ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•˜ê¸° ì „ê¹Œì§€ taps subjectì˜ ì´ë²¤íŠ¸ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.
// isReady subject(publisher)ê°€ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•œ ì´í›„ë¶€í„° tap subjectì˜ ì´ë²¤íŠ¸ê°€ ë°©ì¶œë©ë‹ˆë‹¤.
(1...10).forEach { n in
	if n == 6 { isReady.send(()) } // isReady subjectì—ì„œ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œ í•˜ëŠ” ì‹œì  ë¶€í„° taps subjectë¡œë¶€í„° ì´ë²¤íŠ¸ë¥¼ ë°›ìŒ
	taps.send(n) // isReadyê°€ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•œ ì´í›„ë¶€í„° tap subject(publisher)ëŠ” ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œ, êµ¬ë… ê°’ ìˆ˜ì‹ ì´ ê°€ëŠ¥
}
~~~



### 4-33. prefix, prefix(while:)

- prefix operatorëŠ”  Sequenceì˜ ì²«ë²ˆì§¸ë¶€í„° Nê°œì˜ ì´ë²¤íŠ¸ë§Œ ë°©ì¶œí•˜ë„ë¡ í• ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- prefix(while:) operatorëŠ” íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ì§€ ì•ŠëŠ” ì´ë²¤íŠ¸ê°€ ë‚˜ì˜¤ê¸° ì „ê¹Œì§€ì˜ prefix eventë¥¼ ë°©ì¶œí•©ë‹ˆë‹¤.
  - ìµœì´ˆ ì¡°ê±´ì„ ë¯¸ì¶©ì¡±í•˜ê¸° ì´ì „ ê¹Œì§€ eventë¥¼ ë°©ì¶œí•©ë‹ˆë‹¤.


~~~swift
// MARK: 33. prefix(_:), prefix(while:) operator
let numbers = (1...10).publisher
print("What is the prefix operator in Combine framework?")
numbers
	.prefix(3) // ì²«ë²ˆì§¸ ë¶€í„° 3ê°œì˜ ì´ë²¤íŠ¸ë§Œ ë°©ì¶œ
	.sink { element in
		print(element) // 1, 2, 3
	}

numbers
	.prefix(while: { $0 % 3 != 0 }) // 3ìœ¼ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€ê°€ 3ì´ ì•„ë‹Œ ë™ì•ˆ ë°©ì¶œ
	.sink {
    print($0) // 1, 2
  }
~~~





### 4-34~35. Challenge: Filter all the things

### ğŸµ operator exercise

~~~swift
let publisher = [1, 1, 1, 2, 2, 2, 3, 3, 3, 1, 1]
      .reduce(into: Set<Int>()) { result, value in // ì¤‘ë³µ ì œê±°
        result.insert(value)
      }
      .sorted() // ì¤‘ë³µ ì œê±° í›„ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
      .publisher // Publisher ë³€í™˜ í›„ êµ¬ë… ì§„í–‰
      .sink { value in
        print(value) // 1, 2, 3 ìˆ˜ì‹ 
      }
~~~



### ğŸµ operator exercise2

- Challenge: Filter all the things with solution (dropFirst + prefix + filter)

~~~swift
/*
Challenge: Filter all the things

Create an example that publishes a collection of numbers from 1 through 100, and use filtering operators to:

1. Skip the first 50 values emitted by the upstream publisher.
2. Task the next 20 values after those first 50 values.
3. Only task even numbers.

The output of your example should produce the follwing numbers, one per line:
*/

let publisher = (1...100).publisher
publisher
  .dropFirst(50) // or, drop(while: { $0 <= 50 }), 1) ì²˜ìŒ 50ê°œì˜ ì´ë²¤íŠ¸ëŠ” ë¬´ì‹œí•©ë‹ˆë‹¤.
  .prefix(20) // 50ê°œ ì´ë²¤íŠ¸ ë²„ë¦° í›„, ì²˜ìŒ 20ê°œì˜ ì´ë²¤íŠ¸ëŠ” ë°©ì¶œí•©ë‹ˆë‹¤.
  .filter({ $0 & 1 == 0 }) // ë°©ì¶œí•˜ëŠ” 20ê°œ ì´ë²¤íŠ¸ ì¤‘, ì§ìˆ˜ë§Œ ë°©ì¶œí•©ë‹ˆë‹¤.
  .sink(receiveValue: {
    print($0)
  })
~~~



## Section 5: Combining Operators

### 5-36~37. prepend, append operator

- prepend
  - prepend operatorëŠ” appendì˜ ë°˜ëŒ€ë¡œ Sequence ì•ì— ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€ì‹œí‚¬ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - ë‹¨ì¼ event ë¿ë§Œ ì•„ë‹ˆë¼ Sequence publisherë¥¼ ì¸ìë¡œ ë„£ì–´ì„œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

~~~swift
// MARK: 36. preappend operator
let numbers = (1...5).publisher
let publisher2 = (500...510)
let publisher3 = [0].publisher
numbers
	.prepend(-20, -30) // -20, -30, 1, 2, 3, 4, 5
	.prepend(100, 200, 300) // 100, 200, 300, -20, -30, 1, 2, 3, 4, 5
	.prepend(publisher2) // 500, 501, ... 510, 100, 200, 300, -20, -30, 1, 2, 3, 4, 5
	.prepend(publisher3) // 0, 500, 501, ... 510, 100, 200, 300, -20, -30, 1, 2, 3, 4, 5
	.sink {
		print($0) // 0, 500, 501, ... 510, 100, 200, 300, -20, -30, 1, 2, 3, 4, 5
  }
~~~



- append
  - append operatorëŠ” prependì™€ ë°˜ëŒ€ë¡œ Sequence ëì— ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - prependì²˜ëŸ¼ ë‹¤ë¥¸ publisherë¥¼ append operator ì¸ìë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

~~~swift
// MARK: 37. append operator
let numbers = (1...10).publisher
let publisher2 = (100...101).publisher
let publisher3 = [-1].publisher
numbers
  .append(99, 98, 97)
  .append(-30, -20, -10)
  .append(publisher2)
  .append(publisher3)
  .sink {
  print($0)
}
~~~



### 5-38. switchToLatest operator

- PassthroughSubjectë¥¼ Outputìœ¼ë¡œ ê°–ê³  ìˆëŠ” publishers Subjectê°€ ìˆë‹¤ê³  ë´…ì‹œë‹¤.

~~~swift
let publishers = PassthroughSubject<PassthroughSubject<String, Never>, Never>()
~~~



-  publishers Subjectì—ì„œ switchToLatestë¥¼ ì‚¬ìš©í•˜ë©´, ì´í›„, publishers Subjectê°€ ê°€ì¥ ìµœê·¼ì— ë°©ì¶œí•œ PassthroughSubjectì— ëŒ€í•œ ì´ë²¤íŠ¸ë§Œ ìˆ˜ì‹  ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

~~~swift
// MARK: 38. switchToLatest operator
// switchToLatest operatorëŠ” ê°€ì¥ ìµœê·¼ ë°©ì¶œí•œ publisherì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë°›ê³ ìí• ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
// ex) ê°€ì¥ ìµœê·¼ì— publisherA ì´ë²¤íŠ¸ ë°©ì¶œí–ˆë‹¤ë©´, publisherAê°€ ë°©ì¶œí•œ ì´ë²¤íŠ¸ë§Œ ë°›ëŠ”ë‹¤.
let publisher = PassthroughSubject<String, Never>()
let publisher2 = PassthroughSubject<String, Never>()
let publishers = PassthroughSubject<PassthroughSubject<String, Never>, Never>()
publishers.switchToLatest().sink {
  print($0)
}

// publisherë¥¼ ë°©ì¶œí•˜ë©´ publisherê°€ ë°©ì¶œí•˜ëŠ” ì´ë²¤íŠ¸ë§Œ ìˆ˜ì‹  ê°€ëŠ¥í•˜ë‹¤.
publisher.send("Publisher - A")
publishers.send(publisher) // switching to publisher
publisher.send("Publisher - B")
publishers.send(publisher2)
// publishersê°€ ê°€ì¥ ìµœê·¼ì— publisher2ë¥¼ ë°©ì¶œí–ˆìœ¼ë¯€ë¡œ publisher2ê°€ ì•„ë‹Œ publisherì—ì„œ ë°©ì¶œëœ ì´ë²¤íŠ¸ëŠ” ìˆ˜ì‹ í•˜ì§€ ëª»í•œë‹¤.
publisher.send("Publisher - C") // switcing to publisher2
// publishersì—ì„œ ê°€ì¥ ìµœê·¼ ë°©ì¶œëœ publisher2ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹  ê°€ëŠ¥í•˜ë‹¤.
publisher2.send("Publisher2 - A")
publisher2.send("Publisher2 - B")

~~~



### 5-39. switchToLatest operator usecase

~~~swift
// MARK: 39. switchToLatest continued
// switchToLatest operatorì— ëŒ€í•œ ì‹¤ ì‚¬ìš© ì˜ˆì‹œë¥¼ ì•Œì•„ë³´ì.
// switchToLatest operatorë¥¼ í™œìš©í•˜ë©´ ë²„íŠ¼ì„ íƒ­í•˜ê³ , íƒ­ ì´ë²¤íŠ¸ ì´í›„ ì´ë¯¸ì§€ë¥¼ ìš”ì²­í•´ì„œ ë°›ì•„ì˜¬ë•Œ, ê°€ì¥ ìµœê·¼ì— ì„ íƒí•œ index(ìƒíƒœ)ì— ëŒ€í•œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.
let images = ["Houston", "Denver", "Seattle"]
var index = 0

func getImage() -> AnyPublisher<UIImage?, Never> {
  print("getImage calling")
  return Future<UIImage?, Never> { promise in // futureë¥¼ ì‚¬ìš©í•˜ë©´ í´ë¡œì ¸ ë‚´ì—ì„œ ê²°ê³¼ê°’ì„ ë°©ì¶œí•  ìˆ˜ ìˆë‹¤.
    print("getImage promise closure")
    DispatchQueue.global().asyncAfter(deadline: .now() + 3.0) {
      print("image callback fired")
      promise(.success(UIImage(named: images[index]))) // ë¹„ë™ê¸°ì ìœ¼ë¡œ ì•½ 3ì´ˆ í›„ ì„ íƒëœ ì¸ë±ìŠ¤ì— ë§ëŠ” ì´ë¯¸ì§€ë¥¼ ì½œë°±ìœ¼ë¡œ ì „ë‹¬í•œë‹¤.
    }
  } // -> Future<UIImage?, Never>
  .map { $0 } // -> UIImage?
  .receive(on: RunLoop.main)
  .eraseToAnyPublisher() // -> AnyPublisher<UIImage?, Never>
}

let taps = PassthroughSubject<Void, Never>() // ë²„íŠ¼ íƒ­ ì˜ˆì‹œë¡œ ì‚¬ìš©ë˜ëŠ” subject publisher
let subscription = taps.map { _ in getImage() }
  .print()
  .switchToLatest().sink {
    print($0)
  }

// getImage ë©”ì„œë“œëŠ” 3ì´ˆë’¤ ì´ë¯¸ì§€ë¥¼ ì „ë‹¬í•œë‹¤.
// 1) ì²«ë²ˆì§¸ taps.send() ë°œìƒ 3ì´ˆ ë’¤, indexëŠ” ê·¸ëŒ€ë¡œ 0ì´ë¯€ë¡œ subscriptionì„ í†µí•´ houstonì— ëŒ€í•œ UIImageë¥¼ ì´ë²¤íŠ¸ë¡œ ë°›ìŠµë‹ˆë‹¤.
taps.send()
// => 3ì´ˆ ë’¤ 0ë²ˆì§¸ ì¸ë±ìŠ¤ì˜ ì´ë¯¸ì§€ë¥¼ ë°›ìŒ

// 2) 6ì´ˆ ë’¤ì— ì‹¤í–‰ë˜ëŠ” A ë¹„ë™ê¸° ì½”ë“œ
DispatchQueue.main.asyncAfter(deadline: .now() + 6.0, execute: {
  // 3) 6ì´ˆ ë’¤, index += 1 í›„ indexëŠ” 1ì´ ëœë‹¤.
  // 4) indexê°€ 1ì´ ë˜ê³  tap ì´ë²¤íŠ¸ê°€ ë°œìƒí•œë‹¤. 3ì´ˆ ë’¤ ì´ë¯¸ì§€ë¥¼ ë°›ì„ ê²ƒì´ë‹¤.
  index += 1
  taps.send()
})

// seattle index(2)ì¼ë•ŒëŠ” 6.5ì´ˆ ë’¤ì— ì´ë²¤íŠ¸ë¥¼ ë³´ë‚¸ë‹¤. ì‹¤ì§ˆì ìœ¼ë¡œëŠ” 6ì´ˆë’¤ ì‹¤í–‰ë˜ì—ˆë˜ ìœ„ ì½”ë“œ ì‹¤í–‰ 0.5ì´ˆ ë’¤ ì‹¤í–‰ëœë‹¤.
DispatchQueue.main.asyncAfter(deadline: .now() + 6.5, execute: {
  // 5) 6.5ì´ˆ ë’¤(A ë¹„ë™ê¸° ì½”ë“œ ì‹¤í–‰ 0.5ì´ˆ í›„) indexê°€ í•œë²ˆ ë” ì¦ê°€í•œë‹¤. index == 2 ì´ë‹¤.
  // 6) A ë¹„ë™ê¸° ì½”ë“œì—ì„œ ë°œìƒí•œ tap ì´ë²¤íŠ¸ì— ëŒ€í•œ getImage ì½œë²¡ì„ ìˆ˜ì‹ í•œë‹¤. ì´ë•Œ indexëŠ” 2ì´ë¯€ë¡œ, Denverê°€ ì•„ë‹Œ Seattleì— ëŒ€í•œ ì´ë¯¸ì§€ë¥¼ ë°›ê²Œëœë‹¤.
  // => indexê°€ 1ì¸ ì‹œì ì—ì„œ A ë¹„ë™ê¸° ì½”ë“œì— ì˜í•´ getImage ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì§€ë§Œ, image ì½œë²¡ì„ ë°›ëŠ” 3ì´ˆ ë™ì•ˆ ì´ë¯¸ indexê°€ 2ë¡œ ë°”ë€Œì—ˆê¸° ë•Œë¬¸ì—, index == 2 ì´ë¯¸ì§€ì¸ Seattle ì´ë¯¸ì§€ë¥¼ ì´ë²¤íŠ¸ë¡œ ë°›ê²Œ ëœë‹¤.
  //
  index += 1
  taps.send()
})

// Denverê°€ ì•„ë‹Œ ìµœê·¼ indexì— ëŒ€í•œ ì´ë¯¸ì§€ì¸ Seattle ì´ë¯¸ì§€ë¥¼ ë°›ê²Œ ëœë‹¤. ì´ì²˜ëŸ¼ switchToLatest operatorëŠ” ê°€ì¥ ìµœê·¼ ìƒíƒœì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë°›ê³  ì‹¶ì„ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
~~~



### 5-40. merge operator

- merge operatorëŠ” ì—¬ëŸ¬ê°œì˜ publisherë¥¼ í•©ì¹  ìˆ˜ ìˆê³ , ì‹œê°„ ìˆœìœ¼ë¡œ í•©ì¹œ publisherë“¤ì˜ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

~~~swift
// MARK: 40. merge operator
let publisher1 = PassthroughSubject<Int, Never>()
let publisher2 = PassthroughSubject<Int, Never>()
publisher1.merge(with: publisher2).sink {
	print($0)
}

// mergeë¡œ í•©ì¹œ ì—¬ëŸ¬ê°œì˜ subject publisherì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ì‹œê°„ ìˆœìœ¼ë¡œ ìˆ˜ì‹ í•  ìˆ˜ ìˆë‹¤.
// Output : 1, 2, 4, 6, 7, 8
publisher1.send(1)
publisher1.send(2)

publisher2.send(4)
publisher2.send(6)

publisher1.send(7)
publisher1.send(8)
~~~



### 5-41. combineLatest operator

- combineLatestëŠ” RxSwiftì˜ ë™ì¼ ì´ë¦„ ì—°ì‚°ìì™€ ë™ì‘ì´ ëª¨ë‘ ìœ ì‚¬í•˜ë‹¤.
- publisherë“¤ì˜ ê°€ì¥ ìµœê·¼ ê°’ë“¤ì„ ë°©ì¶œí•œë‹¤. (ìµœì†Œ í•œë²ˆì”©ì€ ë°©ì¶œì´ ë˜ì–´ì•¼ ìŒìœ¼ë¡œ ë°©ì¶œì´ ë¨)
  - í™œìš© ê°€ëŠ¥í•œ ì¼€ì´ìŠ¤ : ëª¨ë“  í…ìŠ¤íŠ¸ í•„ë“œë¥¼ ì±„ìš´ ì´í›„ì— ê°ê°ì˜ í…ìŠ¤íŠ¸ ìƒíƒœë¥¼ ê°ì§€í•˜ê³  ì‹¶ì„ë•Œ


~~~swift
// MARK: 41. combineLatest operator
// combineLatestëŠ” RxSwiftì™€ ì´ë¦„ ë™ì‘ì´ ëª¨ë‘ ìœ ì‚¬í•©ë‹ˆë‹¤.
// 1) ë‘ê°œì˜ publisher ìµœì‹  ê°’ì„ ì´ë²¤íŠ¸ë¡œ ë°©ì¶œí•©ë‹ˆë‹¤.
// 2) ë‘˜ ì¤‘ ì–´ëŠ í•˜ë‚˜ì˜ ì´ë²¤íŠ¸ê°€ ë°©ì¶œë ë•Œë§ˆë‹¤ ê° publisherì˜ ìµœì‹ ê°’ì„ ë°©ì¶œí•©ë‹ˆë‹¤.
// 3) ì„œë¡œ ë‹¤ë¥¸ ê°’ íƒ€ì…ì˜ publisherë“¤ì— ëŒ€í•´ì„œë„ combineLatest operatorë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì‹  ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
let publisher1 = PassthroughSubject<Int, Never>()
let publisher2 = PassthroughSubject<String, Never>()
publisher1.combineLatest(publisher2)
  .sink {
    print("P1: \($0), P2: \($1)")
  }
publisher1.send(1) // nothing
publisher1.send(2) // nothing

publisher2.send("A") // 2, "A"
publisher2.send("B") // 2, "B"

publisher1.send(3) // 3, "B"
~~~



### zip operator

- zip operatorëŠ” ê°ê°ì˜ publisherì— ëŒ€í•œ ë™ì¼ ìˆœì„œì˜ ì´ë²¤íŠ¸ë¥¼ íŠœí”Œë¡œ ë¬¶ì–´ì„œ ë°©ì¶œí•©ë‹ˆë‹¤.
- ë§Œì•½ ë™ì¼ ìˆœì„œì˜ ì´ë²¤íŠ¸ ìŒì„ ë§ì¶”ì§€ ëª»í•œë‹¤ë©´, ë°©ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

~~~swift
// MARK: 41. combineLatest operator
// combineLatestëŠ” RxSwiftì™€ ì´ë¦„ ë™ì‘ì´ ëª¨ë‘ ìœ ì‚¬í•©ë‹ˆë‹¤.
// 1) ë‘ê°œì˜ publisher ìµœì‹  ê°’ì„ ì´ë²¤íŠ¸ë¡œ ë°©ì¶œí•©ë‹ˆë‹¤.
// 2) ë‘˜ ì¤‘ ì–´ëŠ í•˜ë‚˜ì˜ ì´ë²¤íŠ¸ê°€ ë°©ì¶œë ë•Œë§ˆë‹¤ ê° publisherì˜ ìµœì‹ ê°’ì„ ë°©ì¶œí•©ë‹ˆë‹¤.
// 3) ì„œë¡œ ë‹¤ë¥¸ ê°’ íƒ€ì…ì˜ publisherë“¤ì— ëŒ€í•´ì„œë„ combineLatest operatorë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì‹  ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
let publisher1 = PassthroughSubject<Int, Never>()
let publisher2 = PassthroughSubject<String, Never>()
publisher1.combineLatest(publisher2)
  .sink {
    print("P1: \($0), P2: \($1)")
  }
publisher1.send(1) // nothing
publisher1.send(2) // nothing

publisher2.send("A") // 2, "A"
publisher2.send("B") // 2, "B"

publisher1.send(3) // 3, "B"
~~~



### min, max, first, last operator

~~~swift
// MARK: 44. first and last
// first, last operatorëŠ” Sequence publisherì˜ ì²˜ìŒ, ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ í˜¹ì€ íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ì²˜ìŒ, ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•  ëŒ€ ì‚¬ìš©í•œë‹¤.
let publisher = ["A", "B", "C", "D", "Bo", "Ba"].publisher

publisher.first().sink { // Sequence publisherì˜ ì²«ë²ˆì§¸ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œ
  print($0) // "A"
}

publisher.first(where: { "Cat".contains($0) }).sink { // íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ì²«ë²ˆì§¸ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•  ìˆ˜ë„ ìˆë‹¤.
  print($0) // "C"
}

publisher.last().sink { // Sequence publisherì˜ ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œ
  print($0) // "Ba"
}

publisher.last(where: { "Boy".contains($0) }).sink { // íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•  ìˆ˜ë„ ìˆë‹¤.
  print($0) // "Bo"
}

// MARK: - Section 6. Sequence Operators
// MARK: 43. min and max operator
// Sequence operatorsëŠ” ì‰¬ìš´í¸ì— ì†í•©ë‹ˆë‹¤. publisher ìê¸° ìì‹ ì˜ ê°’ì— ëŒ€í•œ ì—°ì‚° ìœ„ì£¼ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
// min, max : Sequence publisherì˜ ìµœìˆê°’, ìµœëŒ“ê°’ì„ ë°©ì¶œí•œë‹¤.
let publisher2 = [1, -45, 3, 35, 30, 100].publisher
publisher2.min().sink {
  print($0) // -45
}

publisher2.max().sink {
  print($0) // 100
}
~~~



### output operator

- output operatorëŠ”  Sequence publisherì˜ íŠ¹ì • ì¸ë±ìŠ¤ í˜¹ì€ íŠ¹ì • ë²”ìœ„ì˜ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œ í•˜ë ¤í• ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - íŠ¹ì • ì¸ë±ìŠ¤ë‚˜ ë²”ìœ„ë¥¼ ì¸ìë¡œ ì§€ì •í•˜ì—¬ ê·¸ì— ë§ëŠ” ì´ë²¤íŠ¸ ë°©ì¶œ

~~~swift
// MARK: 45. output operator
let publisher =  ["A", "B", "C", "D"].publisher
print("Output(:at)")
// 2ë²ˆì§¸ì— ìˆëŠ” ì´ë²¤íŠ¸ë§Œ ë°©ì¶œ
publisher.output(at: 2).sink {
  print($0) // "C"
}

print("Output(:in)")
// íŠ¹ì • ë²”ìœ„ì— í•´ë‹¹ë˜ëŠ” ì´ë²¤íŠ¸ë§Œ ë°©ì¶œ
publisher.output(in: 0...2).sink { print($0) } // A, B, C
publisher.output(in: 1...).sink { print($0) } // B, C, D
~~~



### count operator

- "How many values will be emitted by the publisher?"
- count operatorëŠ” publisherì—ì„œ ë°©ì¶œë˜ëŠ” ê°’ì˜ ê°¯ìˆ˜ë¥¼ ë°˜í™˜í• ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

~~~swift
// MARK: 46. count operator
let publisher = ["A", "B", "C", "D", "E"].publisher
let publisher2 = PassthroughSubject<Int, Never>()

publisher.count().sink {
  print($0) // publisher value ê°¯ìˆ˜, 5ë¥¼ ë°˜í™˜
}

publisher2.count().sink {
  print($0)
}

// PassthrouSubject<Int, Never> íƒ€ì…ì˜ subjectëŠ” ì´ë²¤íŠ¸ë¥¼ 3ê°œ ë°©ì¶œí–ˆë‹¤.
publisher2.send(10)
publisher2.send(20)
publisher2.send(50)
// subjectì˜ ê²½ìš° completed ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê¸° ì „ê¹Œì§€ count ê²°ê³¼ë¥¼ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
// subjectì˜ ê²½ìš° completed ì´ë²¤íŠ¸ ë°œìƒ í›„, ì§€ê¸ˆê¹Œì§€ ë°©ì¶œí•œ ì´ë²¤íŠ¸ ê°¯ìˆ˜ê°€ ë‚´ë ¤ì˜µë‹ˆë‹¤.
publisher2.send(completion: .finished) // 3
~~~



### contains operator

- contains operatorëŠ” íŠ¹ì • ê°’ì´ í¬í•¨ë˜ì—ˆëŠ”ì§€ë¥´ í™•ì¸í• ë•Œ ì‚¬ìš©í•˜ë©°, í¬í•¨ ì—¬ë¶€ë¥¼ Booleaníƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

~~~swift
// MARK: 47. contains operator
let publisher = ["A", "B", "C", "D"].publisher
publisher.contains("C").sink { // "C" ê°€ í¬í•¨ë˜ì–´ìˆëŠ”ì§€ë¥¼ Bool íƒ€ì…ìœ¼ë¡œ ë°˜í™˜
	print($0) // true
}

publisher.contains("Z").sink {
  print($0) // false
}

publisher.contains(where: { $0 == "A" }).sink {
  print($0) // true
}
~~~



### reducer operator

- reduce operatorëŠ” ì´ˆê¸°ê°’ì„ ì§€ì • í›„ Sequence publisher ê°’ë“¤ì— ëŒ€í•œ ì—°ì‚°ì„ ëˆ„ì ì‹œí‚¨ ê²°ê³¼ ê°’ì„ ë°˜í™˜í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

~~~swift
// MARK: 49. reduce operator
let publisher =  [1, 2, 3, 4, 5, 6].publisher
// reduce use case 1)
publisher.reduce(0) { accumulator, value in
	print("accumulator : \(accumulator) and the value is \(value)")
	// accumulatorê°€ immutable ê°’ì´ë©°, ëˆ„ì  ì—°ì‚° ê²°ê³¼ë¥¼ ë°˜í™˜í•´ì•¼í•œë‹¤.
	return accumulator + value
}.sink {
  print($0)
}

// reduce use case 2)
// case 1ê³¼ ë™ì¼í•œ ì—°ì‚° ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.
publisher.reduce(0, +).sink {
  print($0)
}

// reduce use case 3)
// publisher sequence ì˜ ê³± ëˆ„ì  ì—°ì‚° ì˜ˆì‹œ
publisher.reduce(1) {
  return $0 * $1 // 1 ~ 6ì˜ ëˆ„ì  ê³± ì—°ì‚°,
}.sink {
  print($0)
}

~~~



### Combine +  URLSession extension ì„ í†µí•œ API ìš”ì²­ 

~~~swift
// MARK: - 50. URLSession extensions
// Combine frameworkë¥¼ í™œìš©í•˜ì—¬ get api request, response ë„¤íŠ¸ì›Œí‚¹ì— ì‚¬ìš©í•  URLSession extensionì„ êµ¬ì„±í•´ë´…ë‹ˆë‹¤.

func getPosts() -> AnyPublisher<Data, URLError> {
  // https://jsonplaceholder.typicode.com/posts
  // https://api.publicapis.org/entries
  guard let url = URL(string: "https://jsonplaceholder.typicode.com/posts") else {
    fatalError("Invalid URL Error !!")
  }

  return URLSession.shared.dataTaskPublisher(for: url) // -> DataTaskPublisher
    .map { $0.data } // -> DataTaskPublisherì˜ Output ì¤‘ dataë¡œ ë§µí•‘
  	.decode(type: [Post].self, decoder: JSONDecoder()) // íŠ¹ì • íƒ€ì…ìœ¼ë¡œ decoding ê°€ëŠ¥
    .eraseToAnyPublisher() // êµ¬ë…ì´ ê°€ëŠ¥í•œ AnyPublisher íƒ€ì…ìœ¼ë¡œ ë°˜í™˜ëœë‹¤.
}

// getPosts ê²°ê³¼ë¥¼ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥í•˜ê¸° ìœ„í•´ì„œëŠ” cancellable ì„ ì–¸ì´ í•„ìš”í•˜ë‹¤.
let cancellable = getPosts().sink(receiveCompletion: { _ in
  print("completion called")
}, receiveValue: {
  print("receiveValue closure called")
  print($0)
})
~~~



### Timer using Combine

- ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ íƒ€ì´ë¨¸ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - RunLoop.schedule (Cancellable íƒ€ì…ìœ¼ë¡œ ê´€ë¦¬)
  - DispatchQueue.main.achedule (Cancellable íƒ€ì…ìœ¼ë¡œ ê´€ë¦¬)
  - Timer.publish (TimerPublisherë¥¼ ë°˜í™˜í•˜ë©´ êµ¬ë… ì‹œ ë°˜í™˜ë˜ëŠ” AnyCancellable íƒ€ì…ìœ¼ë¡œ ê´€ë¦¬)
- RunLoop (runLoop.schedule)

~~~swift
import UIKit
import Combine
import PlaygroundSupport

// MARK: - Section 9. Combine Timers
// MARK: 56. Using Runloop
// RunLoopì€ timer ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. RunLoop.main ì„ ì‚¬ìš©í•˜ë©´ ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ timer ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
// RunLoop ì´ì™¸ì˜ ë°©ì‹ìœ¼ë¡œë„ Combineì„ í™œìš©í•´ì„œ íƒ€ì´ë¨¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

class MyViewController : UIViewController {
  
//  private var cancellables = Set<AnyCancellable>()
  private let runLoop = RunLoop.main
  private var timerSubscription: Cancellable?
  
  override func loadView() {
    let view = UIView()
    view.backgroundColor = .white
    
    let label = UILabel()
    label.frame = CGRect(x: 150, y: 200, width: 200, height: 20)
    label.text = "Hello World!"
    label.textColor = .black
    
    view.addSubview(label)
    self.view = view
  }
  
  override func viewDidLoad() {
    super.viewDidLoad()
    timerSubscription = self.runLoop.schedule(
      after: runLoop.now,
      interval: .seconds(2), // 2ì´ˆ ê°„ê²©ìœ¼ë¡œ íƒ€ì´ë¨¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
      tolerance: .milliseconds(100) // íƒ€ì´ë¨¸ í—ˆìš© ì˜¤ì°¨ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
    ) {
      print("Timer fired")
    }
    
    self.runLoop.schedule(
      after: .init(Date(timeIntervalSinceNow: 3.0))
    ) { [weak self] in
      // 3ì´ˆ ë’¤ êµ¬ë…ì„ ì·¨ì†Œí•˜ë©´ì„œ íƒ€ì´ë¨¸ë¥¼ ì¢…ë£Œ ì‹œí‚¬ ìˆ˜ ìˆë‹¤.
      print("timer cancelled")
      self?.timerSubscription?.cancel()
    }
  }
}
~~~



- Timer class, Timer.publish
  - RunLoop ë°©ì‹ ì´ì™¸ë¡œë„ Timer classì˜  publish íƒ€ì… ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ íƒ€ì´ë¨¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

~~~swift
// MARK: 57. Timer class
  // RunLoop ë°©ì‹ ì´ì™¸ë¡œë„ Timer classì˜ publish íƒ€ì… ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ íƒ€ì´ë¨¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
  // * autoconnect() : upstream connectable publisherì— ìë™ì ìœ¼ë¡œ ì—°ê²°ì„ ì‹œì¼œì£¼ëŠ” ë©”ì„œë“œì´ë‹¤.
  private func usingTimerClass_57() {
    // 1ì´ˆë§ˆë‹¤ ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ íƒ€ì´ë¨¸ë¥¼ ë™ì‘ ì‹œí‚¨ë‹¤.
    cancellable = Timer.publish(every: 1.0, on: .main, in: .common)
      .autoconnect()
      .scan(0) { counter, _ in
        counter + 1 // scan operatorë¥¼ ì‚¬ìš©í•˜ì—¬ timer í˜¸ì¶œ ë‹¹ 1ì”© ì¦ê°€ ì‹œí‚¨ë‹¤.
      }
      .sink { value in
        print("Timer Fired! \(value)")
      }
  }
~~~



- DispatchQueue, DispatchQueue.main.schedule

~~~swift
  // MARK: 58. Using DispatchQueue
  // RunLoop class, Timer class ì— ì´ì–´ íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì„¸ë²ˆì§¸ ë°©ë²•ì€ DispatchQueueì…ë‹ˆë‹¤.
  // DispatchQueue ë¥¼ í†µí•´ íƒ€ì´ë¨¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  private func usingDispatchQueue_58() {
    // RunLoopì—ì„œ ì²˜ëŸ¼, ë©”ëª¨ë¦¬ì—ì„œ holding í•  ìˆ˜ ìˆë„ë¡ timerì‹¤í–‰ ì½”ë“œì— ëŒ€í•œ í• ë‹¹ì„ í•´ì•¼ ì •ìƒ ë™ì‘ì´ ë©ë‹ˆë‹¤.
    // Dispatch.main.scheduleë¡œ íƒ€ì´ë¨¸ ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥
    timerSubscription = queue.schedule(
      after: queue.now,
      interval: .seconds(1)
    ) { [weak self] in
      guard let self = self else { return }
      // timer í˜¸ì¶œë§ˆë‹¤ source subjectì—ì„œ counterê°’ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•©ë‹ˆë‹¤.
      self.source.send(self.counter)
      self.counter += 1
    }
    
    cancellable = source.sink {
      if $0 == 5 {
        // timerê°€ 5ë²ˆì§¸ í˜¸ì¶œë ë•Œ êµ¬ë…ì„ ì·¨ì†Œí•˜ì—¬ íƒ€ì´ë¨¸ ì´ë²¤íŠ¸ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
        self.cancellable?.cancel()
        return
      }
      print($0)
    }
  }
~~~



### breakpoint operator

~~~swift
// MARK: 55. Using debugger with Combine
// breakpoint operatorëŠ” íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë ë•Œ ë””ë²„ê¹…ëª¨ë“œë¡œ ì§„ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. breakpointì²˜ëŸ¼ ë””ë²„ê¹…ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
import UIKit
import Combine

class ViewController: UIViewController {
  
  private var cancellable: AnyCancellable?
  
  override func viewDidLoad() {
    super.viewDidLoad()
    let publisher = (1...10).publisher
    self.cancellable = publisher
      .breakpoint(receiveOutput: { value in
        return value > 9 // valueê°€ 9ë¥¼ ì´ˆê³¼í•˜ê²Œ ë˜ë©´ break pointê°€ ê±¸ë¦¬ë©° ë””ë²„ê¹…ëª¨ë“œë¡œ ì§„ì…í•  ìˆ˜ ìˆë‹¤.
      })
      .sink {
      print($0)
    }
  }
}
~~~





### Section 10. Resources in Combine

~~~swift
 // MARK: - Section 10. Resources in Combine
  // MARK: 59. Understanding the problem
  private func understandingTheProblem_59() {
    guard let url = URL(string: "https://jsonplaceholder.typicode.com/posts") else {
      fatalError("Invalid URL")
    }
    
    let request = URLSession.shared.dataTaskPublisher(for: url)
      .map(\.data) // KeyPathë¥¼ í†µí•´ responseë¹¼ê³  dataë§Œ down streamì— ë„˜ê¸¸ ìˆ˜ ìˆë‹¤. (ë‹¤ìˆ˜ì˜ KeyPathë¥¼ ì§€ì •í•  ìˆ˜ë„ ìˆìŒ.)
      .print() // print operatorë¡œ stream ë™ì‘ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    // subscription1, 2ê°€ ë™ì¼í•œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¨ë‹¤. ë™ì¼í•œ ê²°ê³¼ê°’ì„ ê³µìœ í•˜ì§€ ì•Šê³  ê°ì êµ¬ë…í•˜ì—¬ ë°›ê³  ìˆë‹¤. ì´ëŠ” ì¤‘ë³µ ì‘ì—…ìœ¼ë¡œ ë¹„íš¨ìœ¨ì ì´ë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•  ë°©ë²•ì´ ë¬´ì—‡ì´ ìˆì„ê¹Œ? share operatorë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
    subscription1 = request.sink(receiveCompletion: { _ in }, receiveValue: {
      print($0)
    })
    
    subscription2 = request.sink(receiveCompletion: { _ in }, receiveValue: {
      print($0)
    })
  }
~~~



### share, multicast operator

- share operator
  - share operatorë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ publisherì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë‹¤ìˆ˜ì˜ êµ¬ë…ìê°€ ê³µìœ í•˜ì—¬ ì¤‘ë³µ ì‘ì—… ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

~~~swift
// MARK: - Section 10. Resources in Combine
// MARK: 59. Understanding the problem
// MARK: 60. share operator
// MARK: 61. multicast operator
// 'How can we share the results of a publisher?'
// -> share operatorë¥¼ ì‚¬ìš©í•˜ë©´ ë™ì¼ publisherì— ëŒ€í•œ êµ¬ë… ì´ë²¤íŠ¸ë¥¼ ë‹¤ìˆ˜ì˜ êµ¬ë…ìê°€ ê³µìœ í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì¤‘ë³µ ì‘ì—…ì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
private func understandingTheProblem_59() {
  guard let url = URL(string: "https://jsonplaceholder.typicode.com/posts") else {
    fatalError("Invalid URL")
  }
  
  let request = URLSession.shared.dataTaskPublisher(for: url)
    .map(\.data) // KeyPathë¥¼ í†µí•´ responseë¹¼ê³  dataë§Œ down streamì— ë„˜ê¸¸ ìˆ˜ ìˆë‹¤.
    .print() // print operatorë¡œ stream ë™ì‘ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    .share() // * share operatorë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ publisherì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë‹¤ìˆ˜ì˜ êµ¬ë…ìê°€ ê³µìœ í•˜ì—¬ ì¤‘ë³µ ì‘ì—… ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
    
    // subscription1, 2ê°€ ë™ì¼í•œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¨ë‹¤. ì´ëŠ” ì¤‘ë³µ ì‘ì—…ìœ¼ë¡œ ë¹„íš¨ìœ¨ì ì´ë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•  ë°©ë²•ì´ ë¬´ì—‡ì´ ìˆì„ê¹Œ? share operatorë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
  subscription1 = request.sink(receiveCompletion: { _ in }, receiveValue: {
    print("Subscription 1")
    print($0)
  })
  
  subscription2 = request.sink(receiveCompletion: { _ in }, receiveValue: {
    print("Subscription 2")
    print($0) // share() operatorë¥¼ ì‚¬ìš©í–ˆì„ ê²½ìš°, ë‘ë²ˆì§¸ êµ¬ë…ìëŠ” ì´ë¯¸ ì•ì„œ ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ê³µìœ í•˜ì—¬ ì¤‘ë³µ ì‘ì—…ì„ í•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.
  })

  self.subscription3 = request.sink(receiveCompletion: { _ in }, receiveValue: {
    print("Subscription 3")
    print($0)
  })
  
  let cancellable = request.connect()
}
~~~



- multicast operator
  - multicase operatorì˜ ì¸ìë¡œ ì§€ì •í•œ  Publisherì˜ ê°’ì„ í•´ë‹¹  operatorë¥¼ ì‚¬ìš©í•œ  publisher êµ¬ë…ì ì „ì›ì—ê²Œ ë™ì¼í•˜ê²Œ ë¿Œë ¤ì¤„ ìˆ˜ìˆë‹¤.

~~~swift
// MARK: - Section 10. Resources in Combine
// MARK: 59. Understanding the problem
// MARK: 60. share operator
// MARK: 61. multicast operator
// 'How can we share the results of a publisher?'
// -> share operatorë¥¼ ì‚¬ìš©í•˜ë©´ ë™ì¼ publisherì— ëŒ€í•œ êµ¬ë… ì´ë²¤íŠ¸ë¥¼ ë‹¤ìˆ˜ì˜ êµ¬ë…ìê°€ ê³µìœ í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì¤‘ë³µ ì‘ì—…ì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
private func understandingTheProblem_59() {
  guard let url = URL(string: "https://jsonplaceholder.typicode.com/posts") else {
    fatalError("Invalid URL")
  }
  
  let request = URLSession.shared.dataTaskPublisher(for: url)
    .map(\.data) // KeyPathë¥¼ í†µí•´ responseë¹¼ê³  dataë§Œ down streamì— ë„˜ê¸¸ ìˆ˜ ìˆë‹¤.
    .print() // print operatorë¡œ stream ë™ì‘ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    .multicast(subject: self.subjectToMulticast) // multicast operatorë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ publisherë¥¼ êµ¬ë…í•˜ëŠ” êµ¬ë…ìë“¤ì´ ë™ì¼í•œ subjectê°’ì„ ì „ë‹¬ë°›ì„ ìˆ˜ ìˆê²Œ ëœë‹¤.
//      .share() // * share operatorë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ publisherì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë‹¤ìˆ˜ì˜ êµ¬ë…ìê°€ ê³µìœ í•˜ì—¬ ì¤‘ë³µ ì‘ì—… ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
    
    // subscription1, 2ê°€ ë™ì¼í•œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¨ë‹¤. ì´ëŠ” ì¤‘ë³µ ì‘ì—…ìœ¼ë¡œ ë¹„íš¨ìœ¨ì ì´ë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•  ë°©ë²•ì´ ë¬´ì—‡ì´ ìˆì„ê¹Œ? share operatorë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
  subscription1 = request.sink(receiveCompletion: { _ in }, receiveValue: {
    print("Subscription 1")
    print($0)
  })
  
  subscription2 = request.sink(receiveCompletion: { _ in }, receiveValue: {
    print("Subscription 2")
    print($0) // share() operatorë¥¼ ì‚¬ìš©í–ˆì„ ê²½ìš°, ë‘ë²ˆì§¸ êµ¬ë…ìëŠ” ì´ë¯¸ ì•ì„œ ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ê³µìœ í•˜ì—¬ ì¤‘ë³µ ì‘ì—…ì„ í•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.
  })

  self.subscription3 = request.sink(receiveCompletion: { _ in }, receiveValue: {
    print("Subscription 3")
    print($0)
  })
  
  let cancellable = request.connect()
  // multicast operatorë¡œ ì§€ì •í•œ subjectë¥¼ í†µí•´ request êµ¬ë…ìë“¤ì—ê²Œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.
  self.subjectToMulticast.send(Data())
}
~~~



### Combine Publisher, Operator, Subscriberë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚ ì”¨ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” API ì‚¬ìš©í•˜ê¸°

~~~swift
// MARK: 65. Implementing Webservice
import Foundation
import Combine

final class WebService {
  func fetchWeather(city: String) -> AnyPublisher<Weather, Error> {
    // Constantsì˜ íƒ€ì… í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ weather ê´€ë ¨ URL ì£¼ì†Œë¥¼ ìƒì„±
    guard let url = URL(string: Constants.URLs.weather) else {
      fatalError("Invalid URL !!")
    }
    
		// 1) dataTaskPublisherë¥¼ í†µí•´ data, responseë¥¼ ê°€ì§„ URLSession.DataTaskPublisher ë¥¼ ë°˜í™˜
    // 2) mapì€ keyPathë¥¼ í†µí•´ íŠ¹ì • ë³€ìˆ˜ë§Œ ë‚¨ê¸°ë„ë¡ ë§µí•‘ì´ ê°€ëŠ¥í•˜ë‹¤.
    // 3) decodeë¡œ íŠ¹ì • decoderë¥¼ ì´ìš©í•´ì„œ ë””ì½”ë”©ì„ í•  ìˆ˜ ìˆë‹¤.
    // 4) ë””ì½”ë”© ê²°ê³¼ì—ì„œ mainë§Œ ë‚¨ê¸°ëŠ” ëª¨ìŠµ
    // 5) receive(on:)ìœ¼ë¡œ íŠ¹ì • threadì—ì„œ ë™ì‘í•˜ëŒê³  ì§€ì •í•  ìˆ˜ ìˆë‹¤. UIë¥¼ ë‹¤ë£¨ëŠ” ì½”ë“œì— ì‚¬ìš©ë˜ë¯€ë¡œ main threadì—ì„œ ë™ì‘í•˜ë„ë¡ í•œë‹¤.
    // 6) ë°ì´í„°ì˜ ë‚´ë¶€ì ì¸ ì—°ì‚°ê³¼ì •ì€ ìˆ¨ê¸°ê³ , ìµœì¢… ê²°ê³¼í˜•íƒœë§Œ ë°›ì•„ì„œ êµ¬ë… ê°€ëŠ¥í•˜ë„ë¡ eraseToAnyPublisher()ë¡œ ë°˜í™˜í•˜ê³  ìˆë‹¤.
    return URLSession.shared.dataTaskPublisher(for: url)
      .map(\.data)
      .decode(type: WeatherResponse.self, decoder: JSONDecoder())
      .map { $0.main }
      .receive(on: RunLoop.main) // main threadì—ì„œ ë™ì‘í•˜ë„ë¡ í•©ë‹ˆë‹¤.
      .eraseToAnyPublisher() // ìµœì¢…ì ì¸ í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í• ë•Œ eraseToAnyPublisherë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  }
}
~~~



### throttle, debounce operator

- reference : https://felix-mr.tistory.com/10

- throttle operator
  - ì—°ì† í˜¸ì¶œ ì‹œ, ì§€ì •ëœ ì‹œê°„ê°„ê²©ì„ ì§€ë‚˜ê³  ë‚˜ì„œ ìµœì´ˆ ê°’ í˜¹ì€ latest ê°’ì„ publish í•œë‹¤.
  - ì¤‘ë³µ ì²˜ë¦¬, ì¤‘ë³µ ì´ë²¤íŠ¸ë¥¼ ë°©ì§€í•˜ê³ ì í• ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ë²¤íŠ¸ í˜¸ì¶œ í›„ íŠ¹ì • ì‹œê°„ë™ì•ˆ ë™ì¼ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê¸° ì›ì¹˜ ì•Šì„ ê²½ìš° ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  - latest ì˜µì…˜ì— ë”°ë¼, íŠ¹ì • ì‹œê°„ì´ ì§€ë‚˜ê³  publish ë  ì´ë²¤íŠ¸ ê¸°ì¤€ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤. (latestì˜µì…˜ì´ falseë©´ ì´ˆê¸° ì´ë²¤íŠ¸ ê¸°ì¤€,  trueë©´ ê°€ì¥ ìµœê·¼ ì´ë²¤íŠ¸ ê¸°ì¤€)
  - ex) ë²„íŠ¼ì—  throttleTapì„ ì ìš©, ë‹¨ê¸°ê°„ì— ì—¬ëŸ¬ë²ˆ í„°ì¹˜ê°€ ë  ê²½ìš°, í•œë²ˆë§Œ í—ˆìš©í•  ìˆ˜ ìˆë‹¤.
- debounce operator
  - ì´ë²¤íŠ¸ ë°œìƒ í›„ ì¼ì • ì‹œê°„ ì§€ì¼œë³¸ í›„ íŠ¸ë¦¬ê±°ë¥¼ í•œë‹¤. íŠ¸ë¦¬ê±° ì „ì— ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì´ì „ ì´ë²¤íŠ¸ëŠ” ë¬´íš¨í™” í•œë‹¤. 
  - ìë™ê²€ìƒ‰ ë“±, í•œê¸€ì í•œê¸€ì ì…ë ¥í• ë•Œ APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³ , íƒ€ìê°€ ë©ˆì¶˜ í›„, ì¼ì • ì‹œê°„ì´ ì§€ë‚ ë•Œ ìë™ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë³´ì´ë„ë¡ í•  ìˆ˜ ìˆë‹¤.
  - ex) ìë™ê²€ìƒ‰ ê¸°ëŠ¥

~~~swift
// MARK: combine debounce operator example
final class DebounceViewModel {
  // TextFieldì— ì…ë ¥ë°›ì€ í…ìŠ¤íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ëŠ” text subject
  private(set) var text = PassthroughSubject<String?, Never>()
  private(set) var result = PassthroughSubject<String, Never>()
  
  ... ìƒëµ ...
}

private extension DebounceViewModel {
  
  private func bind() {
    // textê°€ ì…ë ¥ í›„, 0.5ì´ˆê°„ ì¶”ê°€ì ì¸ ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ ì´ì „ ì´ë²¤íŠ¸ëŠ” ë¬´ì‹œëœë‹¤.
    // text ì…ë ¥ í›„, 0.5ì´ˆê°„ ì¶”ê°€ì ì¸ ì´ë²¤íŠ¸ê°€ ì—†ì„ ê²½ìš°, down stream ì´ë²¤íŠ¸ê°€ triggerëœë‹¤.
    text
      .debounce(for: 0.5, scheduler: RunLoop.main)
      .compactMap { $0 }
      .sink { self.result.send($0) }
      .store(in: &cancellables)
  }
}
~~~

~~~swift
// MARK: Combine throttle operator example
final class ThrottleViewModel {

  private(set) var touchEvent = PassthroughSubject<Int, Never>()
  @Published private(set) var count = 0
  
  ... ìƒëµ ...
}

private extension ThrottleViewModel {
  func bind() {
    touchEvent
    	.throttle(for: 1, scheduler: RunLoop.main, latest, latest: false)
    	.sink { self.count += $0 }
    	.store(in: &cancellables)
  }
}
~~~
